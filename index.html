<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inserir Links do YouTube</title>

    <!-- Importando as funções necessárias do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script type="text/javascript">
        // Sua configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBQWcrRHJp8WkqcJYKOLwdccG1h-hympfw",
            authDomain: "ytinscritos-b8687.firebaseapp.com",
            projectId: "ytinscritos-b8687",
            storageBucket: "ytinscritos-b8687.firebasestorage.app",
            messagingSenderId: "1020519599238",
            appId: "1:1020519599238:web:8d04c61e7c50bc5055d507",
            measurementId: "G-C1L10R7BL1"
        };

        // Inicializando o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Função para adicionar um novo link no Firestore
        function addLinkToFirestore(url, titulo, minutos) {
            db.collection("youtubeLinks").add({
                url: url,
                titulo: titulo,
                minutos: minutos,
                data: firebase.firestore.FieldValue.serverTimestamp() // Usa timestamp do servidor
            })
            .then(function(docRef) {
                console.log("Documento escrito com ID: ", docRef.id);
                alert("Link adicionado com sucesso!");
                // Após adicionar, exibe os links novamente
                displayLinks();
            })
            .catch(function(error) {
                console.error("Erro ao adicionar documento: ", error);
                alert("Erro ao adicionar link. Tente novamente.");
            });
        }

        // Função para exibir os links na página
        function displayLinks() {
            const linksList = document.getElementById('linksList');
            linksList.innerHTML = ''; // Limpa a lista de links antes de exibir novos

            const query = db.collection("youtubeLinks").orderBy("data", "desc");

            // Escutando as mudanças em tempo real na coleção
            query.onSnapshot((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <strong>${data.titulo}</strong><br>
                        <a href="${data.url}" target="_blank">${data.url}</a><br>
                        <strong>Tempo estimado:</strong> ${data.minutos} minutos<br>
                        <em>Adicionado em: ${data.data.toDate().toLocaleString()}</em><br><br>
                    `;
                    linksList.appendChild(listItem);
                });
            }, (error) => {
                console.error("Erro ao ouvir mudanças: ", error);
            });
        }

        // Função para tratar o envio do formulário
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('linkForm');
            form.addEventListener('submit', (event) => {
                event.preventDefault();

                const linkInput = document.getElementById('youtubeLink');
                const titleInput = document.getElementById('videoTitle');
                const minutesInput = document.getElementById('minutes');

                const link = linkInput.value;
                const title = titleInput.value;
                const minutes = parseInt(minutesInput.value);

                // Validação simples antes de adicionar
                if (!link || !title || isNaN(minutes)) {
                    alert("Por favor, preencha todos os campos corretamente!");
                    return;
                }

                // Adiciona o link ao Firestore
                addLinkToFirestore(link, title, minutes);

                // Limpa os campos após o envio
                linkInput.value = '';
                titleInput.value = '';
                minutesInput.value = '';
            });

            // Exibe os links ao carregar a página
            displayLinks();
        });
    </script>
</head>
<body>
    <h1>Insira seu link do YouTube</h1>
    <form id="linkForm">
        <label for="youtubeLink">Link do YouTube:</label>
        <input type="text" id="youtubeLink" name="youtubeLink" placeholder="Cole seu link aqui" required><br>

        <label for="videoTitle">Título do Vídeo:</label>
        <input type="text" id="videoTitle" name="videoTitle" placeholder="Título do vídeo" required><br>

        <label for="minutes">Tempo estimado (em minutos):</label>
        <input type="number" id="minutes" name="minutes" placeholder="Minutos" required><br>

        <button type="submit">Adicionar</button>
    </form>

    <h2>Links Inseridos:</h2>
    <ul id="linksList"></ul>
</body>
</html>

